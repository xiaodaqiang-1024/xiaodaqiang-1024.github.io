<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Lab1: Xv6 and Unix utilities实验任务启动xv6(难度：Easy)获取实验室的xv6源代码并切换到util分支 1234567$ git clone git:&#x2F;&#x2F;g.csail.mit.edu&#x2F;xv6-labs-2020Cloning into &amp;#x27;xv6-labs-2020&amp;#x27;......$ cd xv6-labs-2020$ git checkout">
<meta property="og:type" content="article">
<meta property="og:title" content="肖大强的个人博客">
<meta property="og:url" content="http://example.com/2022/10/06/labs/requirements/lab1/index.html">
<meta property="og:site_name" content="肖大强的个人博客">
<meta property="og:description" content="Lab1: Xv6 and Unix utilities实验任务启动xv6(难度：Easy)获取实验室的xv6源代码并切换到util分支 1234567$ git clone git:&#x2F;&#x2F;g.csail.mit.edu&#x2F;xv6-labs-2020Cloning into &amp;#x27;xv6-labs-2020&amp;#x27;......$ cd xv6-labs-2020$ git checkout">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/images/p1.png">
<meta property="article:published_time" content="2022-10-06T15:06:31.486Z">
<meta property="article:modified_time" content="2022-10-06T14:55:44.977Z">
<meta property="article:author" content="xiaoq">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/p1.png">

<link rel="canonical" href="http://example.com/2022/10/06/labs/requirements/lab1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh'
  };
</script>

  <title> | 肖大强的个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">肖大强的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/06/labs/requirements/lab1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xiaoq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="肖大强的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-10-06 23:06:31 / Modified: 22:55:44" itemprop="dateCreated datePublished" datetime="2022-10-06T23:06:31+08:00">2022-10-06</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/10/06/labs/requirements/lab1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/10/06/labs/requirements/lab1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Lab1-Xv6-and-Unix-utilities"><a href="#Lab1-Xv6-and-Unix-utilities" class="headerlink" title="Lab1: Xv6 and Unix utilities"></a>Lab1: Xv6 and Unix utilities</h1><h1 id="实验任务"><a href="#实验任务" class="headerlink" title="实验任务"></a>实验任务</h1><h2 id="启动xv6-难度：Easy"><a href="#启动xv6-难度：Easy" class="headerlink" title="启动xv6(难度：Easy)"></a>启动xv6(难度：Easy)</h2><p>获取实验室的xv6源代码并切换到util分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://g.csail.mit.edu/xv6-labs-2020</span><br><span class="line">Cloning into <span class="string">&#x27;xv6-labs-2020&#x27;</span>...</span><br><span class="line">...</span><br><span class="line">$ <span class="built_in">cd</span> xv6-labs-2020</span><br><span class="line">$ git checkout util</span><br><span class="line">Branch <span class="string">&#x27;util&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;util&#x27;</span> from <span class="string">&#x27;origin&#x27;</span>.</span><br><span class="line">Switched to a new branch <span class="string">&#x27;util&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Xv6-labs-2020存储库与本书的xv6-riscv稍有不同;它主要添加一些文件。如果你好奇的话，可以执行<code>git log</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>您将需要使用Git版本控制系统管理和提交文件以及后续的实验室作业。接下来，切换到一个分支(执行<code>git checkout util</code>)，其中包含针对该实验室定制的xv6版本。要了解关于Git的更多信息，请查看Git用户手册。Git允许您跟踪对代码所做的更改。例如，如果你完成了其中一个练习，并且想检查你的进度，你可以通过运行以下命令来提交你的变化:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">&#x27;my solution for util lab exercise 1&#x27;</span></span><br><span class="line">Created commit 60d2135: my solution <span class="keyword">for</span> util lab exercise 1</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>您可以使用<code>git diff</code>命令跟踪您的更改。运行<code>git diff</code>将显示自上次提交以来对代码的更改，<code>git diff origin/util</code>将显示相对于初始xv6-labs-2020代码的更改。这里，<em><strong>origin&#x2F;xv6-labs-2020</strong></em>是git分支的名称，它是包含您下载的初始代码分支。</p>
<ul>
<li><strong>构建并运行xv6</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">riscv64-unknown-elf-gcc    -c -o kernel/entry.o kernel/entry.S</span><br><span class="line">riscv64-unknown-elf-gcc -Wall -Werror -O -fno-omit-frame-pointer -ggdb -DSOL_UTIL -MD -mcmodel=medany -ffreestanding -fno-common -nostdlib -mno-relax -I. -fno-stack-protector -fno-pie -no-pie   -c -o kernel/start.o kernel/start.c</span><br><span class="line">...  </span><br><span class="line">riscv64-unknown-elf-ld -z max-page-size=4096 -N -e main -Ttext 0 -o user/_zombie user/zombie.o user/ulib.o user/usys.o user/printf.o user/umalloc.o</span><br><span class="line">riscv64-unknown-elf-objdump -S user/_zombie &amp;gt; user/zombie.asm</span><br><span class="line">riscv64-unknown-elf-objdump -t user/_zombie | sed <span class="string">&#x27;1,/SYMBOL TABLE/d; s/ .* / /; /^$/d&#x27;</span> &amp;gt; user/zombie.sym</span><br><span class="line">mkfs/mkfs fs.img README  user/xargstest.sh user/_cat user/_echo user/_forktest user/_grep user/_init user/_kill user/_ln user/_ls user/_mkdir user/_rm user/_sh user/_stressfs user/_usertests user/_grind user/_wc user/_zombie </span><br><span class="line">nmeta 46 (boot, super, <span class="built_in">log</span> blocks 30 inode blocks 13, bitmap blocks 1) blocks 954 total 1000</span><br><span class="line">balloc: first 591 blocks have been allocated</span><br><span class="line">balloc: write bitmap block at sector 45</span><br><span class="line">qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp 3 -nographic -drive file=fs.img,<span class="keyword">if</span>=none,format=raw,<span class="built_in">id</span>=x0 -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0</span><br><span class="line"></span><br><span class="line">xv6 kernel is booting</span><br><span class="line"></span><br><span class="line">hart 2 starting</span><br><span class="line">hart 1 starting</span><br><span class="line">init: starting sh</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>

<p>如果你在提示符下输入 <code>ls</code>，你会看到类似如下的输出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">.              1 1 1024</span><br><span class="line">..             1 1 1024</span><br><span class="line">README         2 2 2059</span><br><span class="line">xargstest.sh   2 3 93</span><br><span class="line"><span class="built_in">cat</span>            2 4 24256</span><br><span class="line"><span class="built_in">echo</span>           2 5 23080</span><br><span class="line">forktest       2 6 13272</span><br><span class="line">grep           2 7 27560</span><br><span class="line">init           2 8 23816</span><br><span class="line"><span class="built_in">kill</span>           2 9 23024</span><br><span class="line"><span class="built_in">ln</span>             2 10 22880</span><br><span class="line"><span class="built_in">ls</span>             2 11 26448</span><br><span class="line"><span class="built_in">mkdir</span>          2 12 23176</span><br><span class="line"><span class="built_in">rm</span>             2 13 23160</span><br><span class="line">sh             2 14 41976</span><br><span class="line">stressfs       2 15 24016</span><br><span class="line">usertests      2 16 148456</span><br><span class="line">grind          2 17 38144</span><br><span class="line"><span class="built_in">wc</span>             2 18 25344</span><br><span class="line">zombie         2 19 22408</span><br><span class="line">console        3 20 0</span><br></pre></td></tr></table></figure>

<p>这些是<code>mkfs</code>在初始文件系统中包含的文件；大多数是可以运行的程序。你刚刚跑了其中一个：<code>ls</code>。</p>
<p>xv6没有<code>ps</code>命令，但是如果您键入Ctrl-p，内核将打印每个进程的信息。如果现在尝试，您将看到两行：一行用于init，另一行用于sh。</p>
<p>退出 qemu : <code>Ctrl-a x</code>。</p>
<h2 id="sleep-难度：Easy"><a href="#sleep-难度：Easy" class="headerlink" title="sleep(难度：Easy)"></a>sleep(难度：Easy)</h2><blockquote>
<p>[!TIP|label:YOUR JOB]<br><strong>实现xv6的UNIX程序</strong><code>sleep</code><strong>：您的</strong><code>sleep</code><strong>应该暂停到用户指定的计时数。一个滴答(tick)是由xv6内核定义的时间概念，即来自定时器芯片的两个中断之间的时间。您的解决方案应该在文件<em>user&#x2F;sleep.c</em>中</strong></p>
</blockquote>
<p><strong>提示：</strong></p>
<ul>
<li><p>在你开始编码之前，请阅读《book-riscv-rev1》的第一章</p>
</li>
<li><p>看看其他的一些程序（如***&#x2F;user&#x2F;echo.c, &#x2F;user&#x2F;grep.c, &#x2F;user&#x2F;rm.c***）查看如何获取传递给程序的命令行参数</p>
</li>
<li><p>如果用户忘记传递参数，<code>sleep</code>应该打印一条错误信息</p>
</li>
<li><p>命令行参数作为字符串传递; 您可以使用<code>atoi</code>将其转换为数字（详见***&#x2F;user&#x2F;ulib.c***）</p>
</li>
<li><p>使用系统调用<code>sleep</code></p>
</li>
<li><p>请参阅<em><strong>kernel&#x2F;sysproc.c</strong></em>以获取实现<code>sleep</code>系统调用的xv6内核代码（查找<code>sys_sleep</code>），<em><strong>user&#x2F;user.h</strong></em>提供了<code>sleep</code>的声明以便其他程序调用，用汇编程序编写的<em><strong>user&#x2F;usys.S</strong></em>可以帮助<code>sleep</code>从用户区跳转到内核区。</p>
</li>
<li><p>确保<code>main</code>函数调用<code>exit()</code>以退出程序。</p>
</li>
<li><p>将你的<code>sleep</code>程序添加到<em><strong>Makefile</strong></em>中的<code>UPROGS</code>中；完成之后，<code>make qemu</code>将编译您的程序，并且您可以从xv6的shell运行它。</p>
</li>
<li><p>看看Kernighan和Ritchie编著的《C程序设计语言》（第二版）来了解C语言。</p>
</li>
</ul>
<p>从xv6 shell运行程序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">...</span><br><span class="line">init: starting sh</span><br><span class="line">$ <span class="built_in">sleep</span> 10</span><br><span class="line">(nothing happens <span class="keyword">for</span> a little <span class="keyword">while</span>)</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>如果程序在如上所示运行时暂停，则解决方案是正确的。运行<code>make grade</code>看看你是否真的通过了睡眠测试。</p>
<p>请注意，<code>make grade</code>运行所有测试，包括下面作业的测试。如果要对一项作业运行成绩测试，请键入（不要启动XV6，在外部终端下使用）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./grade-lab-util <span class="built_in">sleep</span></span><br></pre></td></tr></table></figure>

<p>这将运行与<code>sleep</code>匹配的成绩测试。或者，您可以键入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make GRADEFLAGS=<span class="built_in">sleep</span> grade</span><br></pre></td></tr></table></figure>

<p>效果是一样的。</p>
<h2 id="pingpong（难度：Easy）"><a href="#pingpong（难度：Easy）" class="headerlink" title="pingpong（难度：Easy）"></a>pingpong（难度：Easy）</h2><blockquote>
<p>[!TIP|label:YOUR JOB]<br><strong>编写一个使用UNIX系统调用的程序来在两个进程之间“ping-pong”一个字节，请使用两个管道，每个方向一个。父进程应该向子进程发送一个字节;子进程应该打印“<code>&lt;pid&gt;: received ping</code>”，其中<code>&lt;pid&gt;</code>是进程ID，并在管道中写入字节发送给父进程，然后退出;父级应该从读取从子进程而来的字节，打印“<code>&lt;pid&gt;: received pong</code>”，然后退出。您的解决方案应该在文件<em>user&#x2F;pingpong.c</em>中。</strong></p>
</blockquote>
<p><strong>提示：</strong></p>
<ul>
<li><p>使用<code>pipe</code>来创造管道</p>
</li>
<li><p>使用<code>fork</code>创建子进程</p>
</li>
<li><p>使用<code>read</code>从管道中读取数据，并且使用<code>write</code>向管道中写入数据</p>
</li>
<li><p>使用<code>getpid</code>获取调用进程的pid</p>
</li>
<li><p>将程序加入到<em><strong>Makefile</strong></em>的<code>UPROGS</code></p>
</li>
<li><p>xv6上的用户程序有一组有限的可用库函数。您可以在<em><strong>user&#x2F;user.h</strong></em>中看到可调用的程序列表；源代码（系统调用除外）位于<em><strong>user&#x2F;ulib.c</strong></em>、<em><strong>user&#x2F;printf.c</strong></em>和<em><strong>user&#x2F;umalloc.c</strong></em>中。</p>
</li>
</ul>
<p>运行程序应得到下面的输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">...</span><br><span class="line">init: starting sh</span><br><span class="line">$ pingpong</span><br><span class="line">4: received ping</span><br><span class="line">3: received pong</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>如果您的程序在两个进程之间交换一个字节并产生如上所示的输出，那么您的解决方案是正确的。</p>
<h2 id="Primes-素数，难度：Moderate-x2F-Hard"><a href="#Primes-素数，难度：Moderate-x2F-Hard" class="headerlink" title="Primes(素数，难度：Moderate&#x2F;Hard)"></a>Primes(素数，难度：Moderate&#x2F;Hard)</h2><blockquote>
<p>[!TIP|label:YOUR JOB]<br><strong>使用管道编写</strong><code>prime sieve</code><strong>(筛选素数)的并发版本。这个想法是由Unix管道的发明者Doug McIlroy提出的。请查看<a target="_blank" rel="noopener" href="http://swtch.com/~rsc/thread/">这个网站</a>(翻译在下面)，该网页中间的图片和周围的文字解释了如何做到这一点。您的解决方案应该在<em>user&#x2F;primes.c</em>文件中。</strong></p>
</blockquote>
<p>您的目标是使用<code>pipe</code>和<code>fork</code>来设置管道。第一个进程将数字2到35输入管道。对于每个素数，您将安排创建一个进程，该进程通过一个管道从其左邻居读取数据，并通过另一个管道向其右邻居写入数据。由于xv6的文件描述符和进程数量有限，因此第一个进程可以在35处停止。</p>
<p><strong>提示：</strong></p>
<ul>
<li><p>请仔细关闭进程不需要的文件描述符，否则您的程序将在第一个进程达到35之前就会导致xv6系统资源不足。</p>
</li>
<li><p>一旦第一个进程达到35，它应该使用<code>wait</code>等待整个管道终止，包括所有子孙进程等等。因此，主<code>primes</code>进程应该只在打印完所有输出之后，并且在所有其他<code>primes</code>进程退出之后退出。</p>
</li>
<li><p>提示：当管道的<code>write</code>端关闭时，<code>read</code>返回零。</p>
</li>
<li><p>最简单的方法是直接将32位（4字节）int写入管道，而不是使用格式化的ASCII I&#x2F;O。</p>
</li>
<li><p>您应该仅在需要时在管线中创建进程。</p>
</li>
<li><p>将程序添加到<em><strong>Makefile</strong></em>中的<code>UPROGS</code></p>
</li>
</ul>
<p>如果您的解决方案实现了基于管道的筛选并产生以下输出，则是正确的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">...</span><br><span class="line">init: starting sh</span><br><span class="line">$ primes</span><br><span class="line">prime 2</span><br><span class="line">prime 3</span><br><span class="line">prime 5</span><br><span class="line">prime 7</span><br><span class="line">prime 11</span><br><span class="line">prime 13</span><br><span class="line">prime 17</span><br><span class="line">prime 19</span><br><span class="line">prime 23</span><br><span class="line">prime 29</span><br><span class="line">prime 31</span><br><span class="line">$</span><br></pre></td></tr></table></figure>



<p><strong>参考资料翻译：</strong></p>
<blockquote>
<p>考虑所有小于1000的素数的生成。Eratosthenes的筛选法可以通过执行以下伪代码的进程管线来模拟：</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p = get a number from left neighbor</span><br><span class="line">print p</span><br><span class="line">loop:</span><br><span class="line">    n = get a number from left neighbor</span><br><span class="line">    <span class="keyword">if</span> (p does not divide n)</span><br><span class="line">        send n to right neighbor</span><br><span class="line">p = 从左邻居中获取一个数</span><br><span class="line">print p</span><br><span class="line">loop:</span><br><span class="line">    n = 从左邻居中获取一个数</span><br><span class="line">    <span class="keyword">if</span> (n不能被p整除)</span><br><span class="line">        将n发送给右邻居</span><br></pre></td></tr></table></figure>

<p><img src="/images/p1.png" alt="img"></p>
<blockquote>
<p>生成进程可以将数字2、3、4、…、1000输入管道的左端：行中的第一个进程消除2的倍数，第二个进程消除3的倍数，第三个进程消除5的倍数，依此类推。</p>
</blockquote>
<h2 id="find（难度：Moderate）"><a href="#find（难度：Moderate）" class="headerlink" title="find（难度：Moderate）"></a>find（难度：Moderate）</h2><blockquote>
<p>[!TIP|label:YOUR JOB]<br><strong>写一个简化版本的UNIX的<code>find</code>程序：查找目录树中具有特定名称的所有文件，你的解决方案应该放在<em>user&#x2F;find.c</em></strong></p>
</blockquote>
<p>提示：</p>
<ul>
<li>查看<em><strong>user&#x2F;ls.c</strong></em>文件学习如何读取目录</li>
<li>使用递归允许<code>find</code>下降到子目录中</li>
<li>不要在“<code>.</code>”和“<code>..</code>”目录中递归</li>
<li>对文件系统的更改会在qemu的运行过程中一直保持；要获得一个干净的文件系统，请运行<code>make clean</code>，然后<code>make qemu</code></li>
<li>你将会使用到C语言的字符串，要学习它请看《C程序设计语言》（K&amp;R）,例如第5.5节</li>
<li>注意在C语言中不能像python一样使用“<code>==</code>”对字符串进行比较，而应当使用<code>strcmp()</code></li>
<li>将程序加入到Makefile的<code>UPROGS</code></li>
</ul>
<p>如果你的程序输出下面的内容，那么它是正确的（当文件系统中包含文件<em><strong>b</strong></em>和<em><strong>a&#x2F;b</strong></em>的时候）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">...</span><br><span class="line">init: starting sh</span><br><span class="line">$ <span class="built_in">echo</span> &gt; b</span><br><span class="line">$ <span class="built_in">mkdir</span> a</span><br><span class="line">$ <span class="built_in">echo</span> &gt; a/b</span><br><span class="line">$ find . b</span><br><span class="line">./b</span><br><span class="line">./a/b</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>

<h2 id="xargs（难度：Moderate）"><a href="#xargs（难度：Moderate）" class="headerlink" title="xargs（难度：Moderate）"></a>xargs（难度：Moderate）</h2><blockquote>
<p>[!TIP|label:YOUR JOB]<br>编写一个简化版UNIX的<code>xargs</code>程序：它从标准输入中按行读取，并且为每一行执行一个命令，将行作为参数提供给命令。你的解决方案应该在<em><strong>user&#x2F;xargs.c</strong></em></p>
</blockquote>
<p>下面的例子解释了<code>xargs</code>的行为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> hello too | xargs <span class="built_in">echo</span> <span class="built_in">bye</span></span><br><span class="line"><span class="built_in">bye</span> hello too</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>注意，这里的命令是<code>echo bye</code>，额外的参数是<code>hello too</code>，这样就组成了命令<code>echo bye hello too</code>，此命令输出<code>bye hello too</code></p>
<p>请注意，UNIX上的<code>xargs</code>进行了优化，一次可以向该命令提供更多的参数。 我们不需要您进行此优化。 要使UNIX上的<code>xargs</code>表现出本实验所实现的方式，请将<code>-n</code>选项设置为1。例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;1\n2&quot;</span> | xargs -n 1 <span class="built_in">echo</span> line</span><br><span class="line">line 1</span><br><span class="line">line 2</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong></p>
<ul>
<li>使用<code>fork</code>和<code>exec</code>对每行输入调用命令，在父进程中使用<code>wait</code>等待子进程完成命令。</li>
<li>要读取单个输入行，请一次读取一个字符，直到出现换行符（’\n’）。</li>
<li><em><strong>kernel&#x2F;param.h</strong></em>声明<code>MAXARG</code>，如果需要声明<code>argv</code>数组，这可能很有用。</li>
<li>将程序添加到<em><strong>Makefile</strong></em>中的<code>UPROGS</code>。</li>
<li>对文件系统的更改会在qemu的运行过程中保持不变；要获得一个干净的文件系统，请运行<code>make clean</code>，然后<code>make qemu</code></li>
</ul>
<p><code>xargs</code>、<code>find</code>和<code>grep</code>结合得很好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . b | xargs grep hello</span><br></pre></td></tr></table></figure>

<p>将对“<code>.</code>”下面的目录中名为<em><strong>b</strong></em>的每个文件运行<code>grep hello</code>。</p>
<p>要测试您的<code>xargs</code>方案是否正确，请运行shell脚本<em><strong>xargstest.sh</strong></em>。如果您的解决方案产生以下输出，则是正确的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ make qemu</span><br><span class="line">...</span><br><span class="line">init: starting sh</span><br><span class="line">$ sh &lt; xargstest.sh</span><br><span class="line">$ $ $ $ $ $ hello</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">$ $   </span><br></pre></td></tr></table></figure>

<p>你可能不得不回去修复你的<code>find</code>程序中的bug。输出有许多<code>$</code>，因为xv6 shell没有意识到它正在处理来自文件而不是控制台的命令，并为文件中的每个命令打印<code>$</code>。</p>
<h1 id="提交实验"><a href="#提交实验" class="headerlink" title="提交实验"></a>提交实验</h1><p><strong>这就完成了实验</strong>。确保你通过了所有的成绩测试。如果这个实验有问题，别忘了把你的答案写在<em><strong>answers-lab-name.txt</strong></em>中<em><strong>。</strong></em>提交你的更改（包括<em><strong>answers-lab-name.txt</strong></em>），然后在实验目录中键入<code>make handin</code>以提交实验。</p>
<p><strong>花费的时间</strong></p>
<p>创建一个命名为<em><strong>time.txt</strong></em>的新文件，并在其中输入一个整数，即您在实验室花费的小时数。不要忘记<code>git add</code>和<code>git commit</code>文件。</p>
<p><strong>提交</strong></p>
<p>你将使用**<a target="_blank" rel="noopener" href="https://6828.scripts.mit.edu/2020/handin.py/">提交网站</a>**提交作业。您需要从提交网站请求一次API密钥，然后才能提交任何作业或实验。</p>
<p>将最终更改提交到实验后，键入<code>make handin</code>以提交实验。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">&quot;ready to submit my lab&quot;</span></span><br><span class="line">[util c2e3c8b] ready to submit my lab</span><br><span class="line"> 2 files changed, 18 insertions(+), 2 deletions(-)</span><br><span class="line"></span><br><span class="line">$ make handin</span><br><span class="line">tar: Removing leading `/<span class="string">&#x27; from member names</span></span><br><span class="line"><span class="string">Get an API key for yourself by visiting https://6828.scripts.mit.edu/2020/handin.py/</span></span><br><span class="line"><span class="string">Please enter your API key: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 79258  100   239  100 79019    853   275k --:--:-- --:--:-- --:--:--  276k</span></span><br><span class="line"><span class="string">$</span></span><br></pre></td></tr></table></figure>

<p><code>make handin</code>将把你的API密钥存储在<em><strong>myapi.key</strong></em>中。如果需要更改API密钥，只需删除此文件并让<code>make handin</code>再次生成它(<em><strong>myapi.key</strong></em>不得包含换行符）。</p>
<p>如果你运行了<code>make handin</code>，并且你有未提交的更改或未跟踪的文件，则会看到类似于以下内容的输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> M hello.c</span><br><span class="line">?? bar.c</span><br><span class="line">?? foo.pyc</span><br><span class="line">Untracked files will not be handed in.  Continue? [y/N]</span><br></pre></td></tr></table></figure>

<p>检查上述行，确保跟踪了您的实验解决方案所需的所有文件，即以??开头的行中所显示的文件。您可以使用<code>git add filename</code>命令使git追踪创建的新文件。</p>
<p>如果<code>make handin</code>无法正常工作，请尝试使用curl或Git命令修复该问题。或者你可以运行<code>make tarball</code>。这将为您制作一个tar文件，然后您可以通过我们的web界面上传。</p>
<ul>
<li>请运行“<code>make grade</code>”以确保您的代码通过所有测试</li>
<li>在运行“<code>make handin</code>”之前提交任何修改过的源代码&#96;</li>
<li>您可以检查提交的状态，并在以下位置下载提交的代码：<a target="_blank" rel="noopener" href="https://6828.scripts.mit.edu/2020/handin.py/">https://6828.scripts.mit.edu/2020/handin.py/</a></li>
</ul>
<h1 id="可选的挑战练习"><a href="#可选的挑战练习" class="headerlink" title="可选的挑战练习"></a>可选的挑战练习</h1><ul>
<li><p>编写一个<code>uptime</code>程序，使用<code>uptime</code>系统调用以滴答为单位打印计算机正常运行时间。（easy）</p>
</li>
<li><p>在<code>find</code>程序的名称匹配中支持正则表达式。<em><strong>grep.c</strong></em>对正则表达式有一些基本的支持。（easy）</p>
</li>
<li><p>xv6 shell（<em><strong>user&#x2F;sh.c</strong></em>）只是另一个用户程序，您可以对其进行改进。它是一个最小的shell，缺少建立在真实shell中的许多特性。例如，</p>
<ul>
<li>在处理<strong>文件中的</strong>shell命令时，将shell修改为不打印$（moderate）</li>
<li>将shell修改为支持<code>wait</code>（easy）</li>
<li>将shell修改为支持用“<code>;</code>”分隔的命令列表（moderate）</li>
<li>通过实现左括号“<code>(</code>” 以及右括号“<code>)</code>”来修改shell以支持子shell（moderate）</li>
<li>将shell修改为支持<code>tab</code>键补全（easy）</li>
<li>修改shell使其支持命令历史记录（moderate）</li>
<li>或者您希望shell执行的任何其他操作。</li>
</ul>
</li>
<li><p>如果您非常雄心勃勃，可能需要修改内核以支持所需的内核特性；xv6支持的并不多。</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/10/06/labs/requirements/lab10/" rel="prev" title="">
      <i class="fa fa-chevron-left"></i> 
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/10/06/labs/requirements/lab4/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Lab1-Xv6-and-Unix-utilities"><span class="nav-number">1.</span> <span class="nav-text">Lab1: Xv6 and Unix utilities</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.</span> <span class="nav-text">实验任务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8xv6-%E9%9A%BE%E5%BA%A6%EF%BC%9AEasy"><span class="nav-number">2.1.</span> <span class="nav-text">启动xv6(难度：Easy)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sleep-%E9%9A%BE%E5%BA%A6%EF%BC%9AEasy"><span class="nav-number">2.2.</span> <span class="nav-text">sleep(难度：Easy)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pingpong%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9AEasy%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">pingpong（难度：Easy）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Primes-%E7%B4%A0%E6%95%B0%EF%BC%8C%E9%9A%BE%E5%BA%A6%EF%BC%9AModerate-x2F-Hard"><span class="nav-number">2.4.</span> <span class="nav-text">Primes(素数，难度：Moderate&#x2F;Hard)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9AModerate%EF%BC%89"><span class="nav-number">2.5.</span> <span class="nav-text">find（难度：Moderate）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xargs%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9AModerate%EF%BC%89"><span class="nav-number">2.6.</span> <span class="nav-text">xargs（难度：Moderate）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E5%AE%9E%E9%AA%8C"><span class="nav-number">3.</span> <span class="nav-text">提交实验</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E9%80%89%E7%9A%84%E6%8C%91%E6%88%98%E7%BB%83%E4%B9%A0"><span class="nav-number">4.</span> <span class="nav-text">可选的挑战练习</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xiaoq</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">134</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaoq</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'nPTQNF98hlhFVhx3uT28h3EW-gzGzoHsz',
      appKey     : 'Hj5CW3nJJnJ3rBlGeKK8XQLa',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
